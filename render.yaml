# ============================================
# RENDER DEPLOYMENT CONFIGURATION
# ============================================
#
# Two deployment options:
#
# 1. API Only (api.rkch.tech):
#    - Set MODE=api in environment
#    - Serves API endpoints only
#    - Frontend deployed separately on Vercel
#
# 2. Full Stack (single domain):
#    - Set MODE=full in environment
#    - Serves both API and frontend
#    - No separate frontend deployment needed
#
# ============================================

services:
  # =========================
  # API ONLY (api.rkch.tech)
  # =========================
  - type: web
    name: rk-api
    env: node
    plan: free
    region: oregon
    
    buildCommand: npm ci
    startCommand: npm run server:api
    
    domains:
      - api.rkch.tech
    
    envVars:
      - key: MODE
        value: api
      - key: NODE_ENV
        value: production
      - key: CLIENT_URLS
        value: https://rkch.tech,https://www.rkch.tech,https://preprod.rkch.tech,https://rk-website-navy.vercel.app
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASS
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: APPLE_CLIENT_ID
        sync: false
      - key: APPLE_TEAM_ID
        sync: false
      - key: APPLE_KEY_ID
        sync: false
      - key: APPLE_KEY
        sync: false

  # =========================
  # FULL STACK (optional)
  # =========================
  # Uncomment to use single server deployment
  #
  # - type: web
  #   name: rk-website
  #   env: node
  #   plan: free
  #   
  #   buildCommand: npm ci && npm run build
  #   startCommand: npm run server:full
  #   
  #   envVars:
  #     - key: MODE
  #       value: full
  #     - key: NODE_ENV
  #       value: production
  #     - key: CLIENT_URLS
  #       value: https://yourdomain.com
  #     - key: MONGODB_URI
  #       sync: false
  #     - key: JWT_SECRET
  #       sync: false
